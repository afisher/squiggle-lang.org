---
title: RPN calculator
---

This example is for a [Reverse Polish Notation (RPN)][rpn] calculator. The
Squiggle version contains more exception throwing, which is automatically
generated by Squiggle.

If you're not familiar with RPN, here's a quick translation:

**RPN:** `2 3 4 * 3 - +`

**Normal:** `2 + ((3 * 4) - 3)`

## rpn.js

```javascript
// Note that the Squiggle version has much more
// error checking embedded in its output.

var L = require("lodash");

var text = "2 3 4 * 3 - +";

var table = {
  "+": function(a, b) { return a + b; },
  "-": function(a, b) { return a - b; },
  "*": function(a, b) { return a * b; },
  "/": function(a, b) { return a / b; }
};

function tokenize(text) {
    return text.split(" ").map(tokenValue);
}

function tokenValue(token) {
    if (table.hasOwnProperty(token)) {
        return table[token];
    } else {
        return Number(token);
    }
}

function evaluateWithStack(stack, values) {
    if (values.length === 0) {
        return stack[0];
    }
    var i = stack.length;
    var x = values[0];
    var v = values.slice(1);
    if (L.isFunction(x)) {
        var a = stack[i - 1];
        var b = stack[i - 2];
        var y = x(a, b);
        return evaluateWithStack(
            stack.slice(0, i - 2).concat([y]),
            v
        );
    } else {
        return evaluateWithStack(
            stack.concat([x]),
            v
        );
    }
}

function evaluate(text) {
    return evaluateWithStack([], tokenize(text));
}

console.log(evaluate(text));
```

## rpn.squiggle

```squiggle
let L = require "lodash"
let {Number, console} = global

let text = "2 3 4 * 3 - +"

# You have to explicitly ignore arguments
# with an underscore in Squiggle.
def tokenize(text) =
    text.split(" ").map(fn(x, _, _) tokenValue(x))

def tokenValue(token) =
    match token
    case "+" => fn(a, b) a + b
    case "-" => fn(a, b) a - b
    case "*" => fn(a, b) a * b
    case "/" => fn(a, b) a / b
    case num => Number(num)

def evaluateWithStack(stack, values) =
    match values
    case [] =>
        stack[0]
    case [x, ...xs] =>
        if L.isFunction(x) then
            let first = stack[0]
            let second = stack[1]
            let rest = stack.slice(2)
            let y = x(first, second)
            in evaluateWithStack([y] ++ rest, xs)
        else
            evaluateWithStack([x] ++ stack, xs)

def evaluate(text) =
    evaluateWithStack([], tokenize(text))

in console.log(evaluate(text))
```

[rpn]: https://en.wikipedia.org/wiki/Reverse_Polish_notation
